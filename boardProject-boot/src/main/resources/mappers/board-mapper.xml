<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="edu.kh.project.board.model.mapper.BoardMapper">
 <!--  namespace에 연결할 Mapper 인터페이스 패키지명+인터페이스명 작성
 		-> Mapper 인터페이스 메서드 호출 시
 		xml 파일에 작성된 태그 중 메서드명과 같은 id를 가진 SQL 구문 수행 
  -->
	<!--  
	_ 케이스를 camelcase로 자동변환하는건 DTO가 있어야 하는데, 없으므로 별칭으로
	자바코드에서 쓰이는 카멜케이스로지정해야함
	 -->
<select id="selectBoardTypeList">
SELECT BOARD_CODE "boardCode", BOARD_NAME "boardName"
FROM BOARD_TYPE
ORDER BY BOARD_CODE 
</select>		

<select id="getListCount">
SELECT COUNT(*) FROM "BOARD"
WHERE BOARD_DEL_FL = 'N'
AND BOARD_CODE = #{boardCode}

</select>

<!-- 
	<![CDATA["문자열"]]>
	
	해당 태그 내부에 작성된 문자열은 특수 기호로
	해석하지 말고 문자 그대로 인식하라는 태그  


 -->

<!--  특정 게시판의 지정된 페이지 목록 조회 -->
<select id="selectBoardList">
SELECT BOARD_NO, BOARD_TITLE, MEMBER_NICKNAME, READ_COUNT , 
(SELECT COUNT(*) FROM "COMMENT" C	WHERE C.BOARD_NO = B.BOARD_NO) COMMENT_COUNT, 

(SELECT COUNT(*) 
FROM "BOARD_LIKE" L	WHERE L.BOARD_NO = B.BOARD_NO ) LIKE_COUNT,	
  <![CDATA[
  CASE 
	WHEN SYSDATE - BOARD_WRITE_DATE < 1 / 24 / 60 --초단위
	THEN FLOOR((SYSDATE - BOARD_WRITE_DATE) * 24 * 60 * 60) || '초 전' 
	
	WHEN SYSDATE - BOARD_WRITE_DATE < 1 / 24 -- 분단위
	THEN FLOOR((SYSDATE - BOARD_WRITE_DATE) * 24 * 60) || '분 전'
	
	WHEN SYSDATE - BOARD_WRITE_DATE < 1  -- 시간단위
	THEN FLOOR((SYSDATE - BOARD_WRITE_DATE) * 24) || '시간 전' 
	
	ELSE TO_CHAR(BOARD_WRITE_DATE, 'YYYY-MM-DD')
	END BOARD_WRITE_DATE
	]]>
	
	FROM "BOARD" B
	JOIN "MEMBER" USING(MEMBER_NO)
	WHERE BOARD_DEL_FL = 'N'
	AND BOARD_CODE = #{boardCode}
	ORDER BY BOARD_NO DESC
</select>

</mapper>